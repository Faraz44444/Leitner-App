var timeout=null,app=vueContext({el:"#app",components:{"c-check-box":compCheckbox},data:function(){return{filter:{Name:"",OrderByDirection:"Asc",OrderBy:2,ItemsPerPage:50,CurrentPage:1,TotalPages:150,Loading:!1},datesFilter:{Loading:!1},overalItems:[],searchResultBusinesses:[],dataDates:{FirstDate:null,LastDate:null},years:[],overalChart:null,yearlyChart:null,selectedYear:null,selectedYearItems:[]}},watch:{selectedYear:function(){this.selectedYearItems=[];this.selectedYearItems=this.overalItems.filter(n=>{let t=new Date(n.Date).getFullYear();return t==this.selectedYear});this.loadYearlyChart()}},computed:{},methods:{getList:function(){if(!this.filter.Loading)return this.filter.Loading=!0,apiHandler.Get("reports/yearlytotaloverview",this.filter).then(n=>{this.overalItems=n,this.loadOveralChart(),this.filter.Loading=!1,this.selectedYear||(this.selectedYear=(new Date).getFullYear())})},loadOveralChart:function(){let n=this.overalItems.filter(n=>!n.IsDeposit).map(n=>n.Price),t=this.overalItems.filter(n=>n.IsDeposit).map(n=>n.Price),i={labels:this.overalItems.filter(n=>n.IsDeposit).map(n=>n.FormattedDate),datasets:[{label:"Expenditure",data:n,borderColor:"rgba(255, 99, 132, 1)",backgroundColor:"rgba(255, 99, 132, 0.2)",borderWidth:2,borderSkipped:!1},{label:"incomes",data:t,borderColor:"rgba(100, 99, 255, 1)",backgroundColor:"rgba(100, 99, 255, 0.2)",borderWidth:2,borderSkipped:!1}]},r={type:"bar",data:i,options:{responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"Overview"}}}};var u=$("#overalChart");this.overalChart&&this.overalChart.destroy();this.overalChart=new Chart(u,r)},loadYearlyChart:function(){let n=this.selectedYearItems.filter(n=>!n.IsDeposit).map(n=>n.Price),t=this.selectedYearItems.filter(n=>n.IsDeposit).map(n=>n.Price),i={labels:this.selectedYearItems.filter(n=>n.IsDeposit).map(n=>n.FormattedDate),datasets:[{label:"Expenditure",data:n,borderColor:"rgba(255, 99, 132, 1)",backgroundColor:"rgba(255, 99, 132, 0.2)",borderWidth:2,borderSkipped:!1},{label:"incomes",data:t,borderColor:"rgba(100, 99, 255, 1)",backgroundColor:"rgba(100, 99, 255, 0.2)",borderWidth:2,borderSkipped:!1}]},r={type:"bar",data:i,options:{responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"Overview"}}}};var u=$("#yearlyChart");this.yearlyChart&&this.yearlyChart.destroy();this.yearlyChart=new Chart(u,r)},getDates:function(){this.datesFilter.Loading||(this.datesFilter.Loading=!0,apiHandler.Get("reports/yearlytotaloverview/lastDate",this.filter).then(n=>{this.dataDates.LastDate=n,this.datesFilter.Loading=!1}).then(()=>{apiHandler.Get("reports/yearlytotaloverview/firstDate",this.filter).then(n=>{this.dataDates.FirstDate=n,this.datesFilter.Loading=!1,this.years=this.computeYears()})}))},computeYears:function(){let t=new Date(this.dataDates.FirstDate).getFullYear(),i=new Date(this.dataDates.LastDate).getFullYear(),n=[];for(let r=t;r<=i;r++)n.push({Id:r,Name:r});return n},filterChanged:function(){this.filter.CurrentPage=1;this.getList()},filterChagnedDelayed:function(){clearTimeout(timeout);timeout=setTimeout(()=>{this.filterChanged()},200)}},created:function(){this.getList();this.getDates()},mounted:function(){$("#datepickere").datepicker()}});