var timeout=null,app=vueContext({el:"#app",components:{"c-check-box":compCheckbox},data:function(){return{filter:{Name:"",OrderByDirection:"Asc",OrderBy:2,ItemsPerPage:50,CurrentPage:1,TotalPages:150,Loading:!1},datesFilter:{Loading:!1},detailItemsFilter:{Loading:!1},overalItems:[],detailItems:[],detailsExpendituresSum:0,detailsIncomesSum:0,searchResultBusinesses:[],dataDates:{FirstDate:null,LastDate:null},years:[],months:[],selectedYear:null,selectedMonth:null,selectedItems:[],chkShowCreatdByAndCreatedAt:!1,MonthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],overviewChart:null}},watch:{selectedYear:function(){this.setMonths()},selectedMonth:function(){this.selectedMonth&&(this.selectedItems=[],this.selectedItems=this.overalItems.filter(n=>n.Year==this.selectedYear&&n.Month==this.selectedMonth+1),this.getDetailItems(),this.loadOverviewChart())},"detailItemsFilter.Title":function(){this.filterChagnedDelayed()},"detailItemsFilter.PaymentPriorityName":function(){this.filterChagnedDelayed()},"detailItemsFilter.BusinessName":function(){this.filterChagnedDelayed()},"detailItemsFilter.Price":function(){this.filterChagnedDelayed()},"detailItemsFilter.IsDeposit":function(){this.filterChanged()},"detailItemsFilter.IsPaidToPerson":function(){this.filterChanged()},"detailItemsFilter.CategoryName":function(){this.filterChagnedDelayed()}},computed:{SelectedDateExpendituresSum:function(){let n=this.selectedItems.filter(n=>n.IsDeposit==!1).map(n=>n.Price).reduce((n,t)=>n+t,0);return Intl.NumberFormat("en-US").format(n)},SelectedDateIncomeSum:function(){let n=this.selectedItems.filter(n=>n.IsDeposit==!0).map(n=>n.Price).reduce((n,t)=>n+t,0);return Intl.NumberFormat("en-US").format(n)},SelectedDateSaving:function(){let n=this.selectedItems.filter(n=>n.IsDeposit==!0).map(n=>n.Price).reduce((n,t)=>n+t,0)-this.selectedItems.filter(n=>n.IsDeposit==!1).map(n=>n.Price).reduce((n,t)=>n+t,0);return Intl.NumberFormat("en-US").format(n)}},methods:{getList:function(){if(!this.filter.Loading)return this.filter.Loading=!0,apiHandler.Get("reports/monthlyoverview",this.filter).then(n=>{this.overalItems=n,this.filter.Loading=!1})},getDetailItems:function(){this.detailItemsFilter.Loading=!0;var n=this.selectedMonth+1;let t=new Date(this.selectedYear,n,0).getDate();return this.detailItemsFilter.DateFrom=this.selectedYear+"-"+n+"-1",this.detailItemsFilter.DateTo=this.selectedYear+"-"+n+"-"+t,apiHandler.Get("payment/lookup",this.detailItemsFilter).then(n=>{this.detailsExpendituresSum=Intl.NumberFormat("en-US").format(n.filter(n=>n.IsDeposit==!1).map(n=>n.Price).reduce((n,t)=>n+t,0)),this.detailsIncomesSum=Intl.NumberFormat("en-US").format(n.filter(n=>n.IsDeposit==!0).map(n=>n.Price).reduce((n,t)=>n+t,0)),this.detailItems=n,this.detailItemsFilter.Loading=!1})},getDates:function(){this.datesFilter.Loading||(this.datesFilter.Loading=!0,apiHandler.Get("reports/monthlyoverview/lastDate",this.filter).then(n=>{this.dataDates.LastDate=n,this.selectedYear||(this.selectedYear=new Date(n).getFullYear(),this.selectedMonth=new Date(n).getMonth()+1),this.datesFilter.Loading=!1,apiHandler.Get("reports/monthlyoverview/firstDate",this.filter).then(n=>{this.dataDates.FirstDate=n,this.datesFilter.Loading=!1,this.years=this.computeYears()})}))},setMonths:function(){var t,r,n;for(this.selectedYear==new Date(this.dataDates.LastDate).getFullYear()?(t=new Date(this.dataDates.LastDate).getMonth(),this.months=[...this.MonthNames.slice(0,t+2)]):this.selectedYear==new Date(this.dataDates.FirstDate).getFullYear()?(r=new Date(this.dataDates.FirstDate).getMonth(),this.months=[...this.MonthNames.slice(r,13)]):this.months=[...this.MonthNames.slice(0,13)],n=[],i=0;i<this.months.length;i++)n.push({Id:i,Name:this.months[i]});this.months=n},loadOverviewChart:function(){let n=[],t=[];this.selectedItems.map(i=>{i.IsDeposit?(t.push(i.Price),n.push(0)):(n.push(i.Price),t.push(0))});let i={labels:this.selectedItems.map(n=>n.CategoryName),datasets:[{label:"Expenditure",data:n,borderColor:"rgba(255, 99, 132, 1)",backgroundColor:"rgba(255, 99, 132, 0.2)",borderWidth:2,borderSkipped:!1},{label:"incomes",data:t,borderColor:"rgba(100, 99, 255, 1)",backgroundColor:"rgba(100, 99, 255, 0.2)",borderWidth:2,borderSkipped:!1}]},r={type:"bar",data:i,options:{responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"Overview"}}}};var u=$("#overviewChart");this.overviewChart&&this.overviewChart.destroy();this.overviewChart=new Chart(u,r)},computeYears:function(){let t=new Date(this.dataDates.FirstDate).getFullYear(),i=new Date(this.dataDates.LastDate).getFullYear(),n=[];for(let r=t;r<=i;r++)n.push({Id:r,Name:r});return n},filterChanged:function(){this.filter.CurrentPage=1;this.getDetailItems()},filterChagnedDelayed:function(){clearTimeout(timeout);timeout=setTimeout(()=>{this.filterChanged()},200)},orderBy:function(n){this.payment.filter=orderByHandler.Handle(this.detailItemsfilter,n);this.filterChanged()}},created:function(){this.getList();this.getDates()},mounted:function(){}});