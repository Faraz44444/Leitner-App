var timeout=null,app=vueContext({el:"#app",data:function(){return{filter:{Name:"",OrderByDirection:"Asc",DateFrom:null,DateTo:null,OrderBy:"Date",OrderByDirection:2,ItemsPerPage:50,CategoryId:0,BusinessId:0,CurrentPage:1,IsDeposit:null,IsPaidToPerson:null,TotalPages:150,Loading:!1,PaymentPriorityId:0},showDetailsModal:!1,paymentDetails:{Title:null,IsPaidToPerson:!1,IsDeposit:!1},businessFilter:{},paymenrRecommendationFilter:{Loading:!1,CurrentPage:1,ItemsPerPage:10},value:null,categories:[],businesses:[],priorities:[],recommendations:[],paymentPriorities:[],items:[],searchResultBusinesses:[],loadingAvailableBusinesses:!1,showItems:!1}},watch:{"filter.Title":function(){this.filterChagnedDelayed()},"paymentDetails.Date":function(){console.log(this.paymentDetails.Date)},"filter.CategoryId":function(){this.filterChanged()},"filter.BusinessId":function(){this.filterChanged()},"filter.PaymentPriorityId":function(){this.filterChanged()},"filter.PriceFrom":function(){this.filterChanged()},"filter.PriceTo":function(){this.filterChanged()},"filter.IsDeposit":function(){this.filterChanged()},"filter.IsPaidToPerson":function(){this.filterChanged()},"filter.DateFrom":function(){this.filterChanged()},"filter.DateTo":function(){this.filterChanged()},"filter.OrderBy":function(){this.filterChanged()},"filter.OrderByDirection":function(){this.filterChanged()},"paymentDetails.BusinessName":function(){this.searchResultBusinesses=[];this.scanBusiness()},showItems:function(){console.log("show items changed !!")}},computed:{},methods:{getList:function(){if(!this.filter.Loading)return this.filter.Loading=!0,apiHandler.Get("payment",this.filter).then(n=>{this.items=n.Items,this.filter.TotalPages=n.TotalPages,this.filter.Loading=!1})},getCategories:function(){return apiHandler.Get("category/lookup",{Deleted:!1}).then(n=>{this.categories=n,this.categories.unshift({CategoryId:0,Name:"All"})})},getBusinesses:function(){return apiHandler.Get("business/lookup",{}).then(n=>{this.businesses=n,this.businesses.unshift({BusinessId:0,Name:"All"})})},getPriorities:function(){return apiHandler.Get("paymentpriority/lookup",{}).then(n=>{this.priorities=n,this.priorities.unshift({PaymentPriorityId:0,Name:"All"})})},getPaymentPrioririties:function(){return apiHandler.Get("paymentPriority/lookup",{Deleted:!1}).then(n=>{this.paymentPriorities=n,this.paymentPriorities.unshift({PaymentPriorityId:0,Name:"All"})})},getPaymentRecommendations:function(){if(!this.paymenrRecommendationFilter.Loading)return this.paymenrRecommendationFilter.Loading=!0,apiHandler.Get("payment/recommendations",this.paymenrRecommendationFilter).then(n=>{this.recommendations=n.Items,this.paymenrRecommendationFilter.TotalPages=n.TotalPages,this.paymenrRecommendationFilter.Loading=!1})},selectRecommendation:function(n){this.paymentDetails.BusinessId=n.BusinessId;this.paymentDetails.CategoryId=n.CategoryId;this.paymentDetails.CategoryName=n.CategoryName;this.paymentDetails.Price=n.AveragePrice;this.paymentDetails.BusinessName=n.BusinessName},openPaymentDetailsModal:function(n){if(n){this.paymentDetails=Object.assign({},n);this.paymentDetails.Date=new Date(n.Date).toISOString().split("T")[0];console.log(new Date(n.Date).toISOString().split("T")[0]);let t=new Date(n.Date);this.paymentDetails.Date=t.getFullYear()+"-"+("0"+(t.getMonth()+1)).slice(-2)+"-"+t.getDate()}else this.paymentDetails={IsPaidToPerson:!1,IsDeposit:!1};this.showDetailsModal=!0},closeModal:function(){this.showDetailsModal=!1},savePayment:function(){if(formvalidation.Validate("paymentDetails"))return this.paymentDetails.PaymentId>0?apiHandler.Put("payment",this.paymentDetails.PaymentId,this.paymentDetails).then(()=>{this.showDetailsModal=!1,this.getList()}):apiHandler.Post("payment",this.paymentDetails).then(()=>{this.getList()})},scanBusiness:function(){if(this.paymentDetails.BusinessName?.length)return this.loadingAvailableBusinesses=!0,this.businessFilter.Name=this.paymentDetails.BusinessName,apiHandler.Get("business/lookup",this.businessFilter).then(n=>{this.searchResultBusinesses=n,$("#searchBusinesses").focus(),this.loadingAvailableBusinesses=!1,this.$refs.businessLookup.showItems()})},selectBusiness:function(n){this.paymentDetails.BusinessId=n.BusinessId;this.paymentDetails.BusinessName=n.Name},filterChanged:function(){this.filter.CurrentPage=1;this.getList()},filterChagnedDelayed:function(){clearTimeout(timeout);timeout=setTimeout(()=>{this.filterChanged()},200)},fetchPage:function(n){this.filter.CurrentPage=n.page;this.getList()},fetchRecommendationPage:function(n){this.paymenrRecommendationFilter.CurrentPage=n.page;this.getPaymentRecommendations()},updateModelDatepickerValue:function(n){this.paymentDetails.Date=n},setOrderByDirection:function(n){this.filter.OrderByDirection=n},setOrderBy:function(n){this.filter.OrderBy=n}},created:function(){this.getList();this.getCategories();this.getBusinesses();this.getPriorities();this.getPaymentPrioririties();this.getPaymentRecommendations()},mounted:function(){}});