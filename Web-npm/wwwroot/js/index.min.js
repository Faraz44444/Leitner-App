var timeout=null,app=vueContext({el:"#app",components:{"c-check-box":compCheckbox},data:function(){return{filter:{Name:"",OrderByDirection:"Asc",OrderBy:2,ItemsPerPage:50,CurrentPage:1,TotalPages:150,Loading:!1},loadingCategories:!1,loadingPaymentsOverview:!1,sums:{Incomes:{},Expenditures:{},Savings:{}},categories:[],paymentsOverview:{Incomes:{},Expenditures:{}},overviewChart:null}},watch:{"filter.Name":function(){this.filterChagnedDelayed()},"PaymentTotalDetails.Date":function(){console.log(this.PaymentTotalDetails.Date)}},computed:{monthlyExpectedExpenditures:function(){const n=new Intl.NumberFormat("fr-FR",{style:"currency",currency:"NOK"});return this.categories.length>0?n.format(this.categories.filter(n=>n.Name!="Saving").map(n=>n.MonthlyLimit).reduce((n,t)=>n+t,0)):0}},methods:{getList:function(){if(!this.filter.Loading)return this.filter.Loading=!0,apiHandler.Get("paymentTotal",this.filter).then(n=>{this.items=n.Items,this.filter.TotalPages=n.TotalPages,this.filter.Loading=!1})},getPaymentsSum:function(){var n=new Date,t=new Date(n.getFullYear(),n.getMonth()+1,0),i=n.getFullYear()+"-"+(n.getMonth()+1)+"-1",r=n.getFullYear()+"-"+(n.getMonth()+1)+"-"+t.getDate(),u={DateFrom:i,DateTo:r};apiHandler.Get("reports/paymentssum",u).then(n=>{this.sums=n})},getCategories:function(){this.loadingCategories=!0;return apiHandler.Get("category/lookup",{HasMonthlyLimit:!0}).then(n=>{this.categories=n,this.loadingCategories=!1})},getPaymentsOverview:function(){if(!this.loadingPaymentsOverview){this.loadingPaymentsOverview=!0;var t=new Date,n={IsDeposit:!0,Date:t.getFullYear()+"-"+(t.getMonth()+1)+"-1"};apiHandler.Get("reports/paymentsoverview",n).then(n=>{this.paymentsOverview.Incomes=n}).then(()=>(n.IsDeposit=!1,apiHandler.Get("reports/paymentsoverview",n).then(n=>{this.paymentsOverview.Expenditures=n,this.loadingPaymentsOverview=!1,this.loadOverviewChart()})))}},loadOverviewChart:function(){let n=this.paymentsOverview.Incomes.map(n=>n.Price),t=this.paymentsOverview.Expenditures.map(n=>n.Price),i={labels:this.paymentsOverview.Incomes.map(n=>n.MonthFormatted),datasets:[{label:"Expenditure",data:t,borderColor:"rgba(255, 99, 132, 1)",backgroundColor:"rgba(255, 99, 132, 0.2)",borderWidth:2,borderSkipped:!1},{label:"incomes",data:n,borderColor:"rgba(100, 99, 255, 1)",backgroundColor:"rgba(100, 99, 255, 0.2)",borderWidth:2,borderSkipped:!1}]},r={type:"bar",data:i,options:{responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"Overview"}}}};var u=$("#overviewChart");this.overviewChart&&this.overviewChart.destroy();this.overviewChart=new Chart(u,r)},filterChanged:function(){this.filter.CurrentPage=1;this.getList()},filterChagnedDelayed:function(){clearTimeout(timeout);timeout=setTimeout(()=>{this.filterChanged()},200)}},created:function(){this.getList();this.getPaymentsSum();this.getCategories();this.getPaymentsOverview()},mounted:function(){$("#datepickere").datepicker()}});