var timeout=null,app=vueContext({el:"#app",components:{"c-check-box":compCheckbox},data:function(){return{filter:{Name:"",OrderByDirection:"Asc",OrderBy:2,ItemsPerPage:50,CurrentPage:1,TotalPages:150,Loading:!1},datesFilter:{Loading:!1},detailItemsFilter:{Loading:!1},overalItems:[],detailItems:[],detailsExpendituresSum:0,detailsIncomesSum:0,searchResultBusinesses:[],dataDates:{FirstDate:null,LastDate:null},years:[],months:[],selectedYear:null,selectedMonth:null,selectedItems:[],chkShowCreatdByAndCreatedAt:!1,MonthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],yearlyChart:null}},watch:{selectedYear:function(){this.setMonths()},selectedMonth:function(){this.selectedMonth&&(this.selectedItems=[],this.selectedItems=this.overalItems.filter(n=>n.Year==this.selectedYear&&n.Month==this.selectedMonth),this.getDetailItems(),this.loadYearlyChart())}},computed:{SelectedDateExpendituresSum:function(){let n=this.selectedItems.filter(n=>n.IsDeposit==!1).map(n=>n.Price).reduce((n,t)=>n+t,0);return Intl.NumberFormat("en-US").format(n)},SelectedDateIncomeSum:function(){let n=this.selectedItems.filter(n=>n.IsDeposit==!0).map(n=>n.Price).reduce((n,t)=>n+t,0);return Intl.NumberFormat("en-US").format(n)},SelectedDateSaving:function(){let n=this.selectedItems.filter(n=>n.IsDeposit==!0).map(n=>n.Price).reduce((n,t)=>n+t,0)-this.selectedItems.filter(n=>n.IsDeposit==!1).map(n=>n.Price).reduce((n,t)=>n+t,0);return Intl.NumberFormat("en-US").format(n)}},methods:{getList:function(){if(!this.filter.Loading)return this.filter.Loading=!0,apiHandler.Get("reports/monthlyoverview",this.filter).then(n=>{this.overalItems=n,this.loadOveralChart(),this.filter.Loading=!1})},getDetailItems:function(){this.detailItemsFilter.Loading=!0;let n=new Date(this.selectedYear,this.selectedMonth,0).getDate();return this.detailItemsFilter.DateFrom=this.selectedYear+"-"+this.selectedMonth+"-1",this.detailItemsFilter.DateTo=this.selectedYear+"-"+this.selectedMont+"-"+n,apiHandler.Get("payment/lookup",this.detailItemsFilter).then(n=>{this.detailsExpendituresSum=Intl.NumberFormat("en-US").format(n.filter(n=>n.IsDeposit==!1).map(n=>n.Price).reduce((n,t)=>n+t,0)),this.detailsIncomesSum=Intl.NumberFormat("en-US").format(n.filter(n=>n.IsDeposit==!0).map(n=>n.Price).reduce((n,t)=>n+t,0)),this.detailItems=n,this.detailItemsFilter.Loading=!1})},getDates:function(){this.datesFilter.Loading||(this.datesFilter.Loading=!0,apiHandler.Get("reports/monthlyoverview/lastDate",this.filter).then(n=>{this.dataDates.LastDate=n,this.selectedYear||(this.selectedYear=new Date(n).getFullYear(),this.selectedMonth=new Date(n).getMonth()),this.datesFilter.Loading=!1}).then(()=>{apiHandler.Get("reports/monthlyoverview/firstDate",this.filter).then(n=>{this.dataDates.FirstDate=n,this.datesFilter.Loading=!1,this.years=this.computeYears()})}))},setMonths:function(){var n,t;this.selectedYear==new Date(this.dataDates.LastDate).getFullYear()?(n=new Date(this.dataDates.LastDate).getMonth(),this.months=[...this.MonthNames.slice(0,n+2)]):this.selectedYear==new Date(this.dataDates.FirstDate).getFullYear()?(t=new Date(this.dataDates.FirstDate).getMonth(),this.months=[...this.MonthNames.slice(t,13)]):this.months=[...this.MonthNames.slice(0,13)]},loadOveralChart:function(){let n=this.overalItems.filter(n=>!n.IsDeposit).map(n=>n.Price),t=this.overalItems.filter(n=>n.IsDeposit).map(n=>n.Price),i={labels:this.overalItems.filter(n=>n.IsDeposit).map(n=>n.FormattedDate),datasets:[{label:"Expenditure",data:n,borderColor:"rgba(255, 99, 132, 1)",backgroundColor:"rgba(255, 99, 132, 0.2)",borderWidth:2,borderSkipped:!1},{label:"incomes",data:t,borderColor:"rgba(100, 99, 255, 1)",backgroundColor:"rgba(100, 99, 255, 0.2)",borderWidth:2,borderSkipped:!1}]},r={type:"bar",data:i,options:{responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"Overview"}}}};var u=$("#yearlyChart");this.yearlyChart&&this.overalChart.destroy();this.yearlyChart=new Chart(u,r)},loadYearlyChart:function(){let n=this.selectedItems.filter(n=>!n.IsDeposit).map(n=>n.Price),t=this.selectedItems.filter(n=>n.IsDeposit).map(n=>n.Price),i={labels:this.selectedItems.filter(n=>n.IsDeposit).map(n=>n.FormattedDate),datasets:[{label:"Expenditure",data:n,borderColor:"rgba(255, 99, 132, 1)",backgroundColor:"rgba(255, 99, 132, 0.2)",borderWidth:2,borderSkipped:!1},{label:"incomes",data:t,borderColor:"rgba(100, 99, 255, 1)",backgroundColor:"rgba(100, 99, 255, 0.2)",borderWidth:2,borderSkipped:!1}]},r={type:"bar",data:i,options:{responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"Overview"}}}};var u=$("#yearlyChart");this.yearlyChart&&this.yearlyChart.destroy();this.yearlyChart=new Chart(u,r)},computeYears:function(){let t=new Date(this.dataDates.FirstDate).getFullYear(),i=new Date(this.dataDates.LastDate).getFullYear(),n=[];for(let r=t;r<=i;r++)n.push(r);return n},filterChanged:function(){this.filter.CurrentPage=1;this.getDetailItems()},filterChagnedDelayed:function(){clearTimeout(timeout);timeout=setTimeout(()=>{this.filterChanged()},200)},orderBy:function(n){this.payment.filter=orderByHandler.Handle(this.detailItemsfilter,n);this.filterChanged()}},created:function(){this.getList();this.getDates()},mounted:function(){}});